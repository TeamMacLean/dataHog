<% include ../head %>
<div class="container">
    <h3><a href="/<%- project.safeName %>"><i class="fa fa-chevron-left"></i> <%- project.name %></a></h3>

    <h1>New Sample</h1>

    <form action="/<%- project.safeName %>/new" method="POST" enctype="multipart/form-data">

        <fieldset>
            <label for="name">Title</label>
            <input type="text" id="name" name="name" required>
        </fieldset>

        <fieldset>
            <label for="uniqueName">Unique Name</label>
            <input type="text" id="uniqueName" name="uniqueName" required>
        </fieldset>

        <fieldset>
            <label for="organism">Organism</label>
            <input type="text" id="organism" name="organism" required>
            <ul id="listByText" class="no-margin no-decoration"></ul>
        </fieldset>

        <fieldset>
            <label for="ncbi">Taxonomy ID</label>
            <input type="number" id="ncbi" name="ncbi" required>
            <!--<label><input type="checkbox" id="custom-org"> do not change organism</label>-->

        </fieldset>

        <fieldset>
            <label for="conditions">Conditions</label>
            <input type="text" id="conditions" name="conditions" required>
        </fieldset>

        <button type="submit" class="button button-primary">Add</button>
    </form>

</div>


<script src="/components/taxlookup/dist/taxlookup.min.js"></script>
<script>


    var ncbi = $('#ncbi');
    var ul = $('#listByText');
    var org = $('#organism');
    //    var custom = $('#custom-org');

    function updateFromNumber() {

        var val = ncbi.val();
        tax.eFetch(val, function (err, out) {

            console.log(out);

            if (out && out.Taxon) {
                org.val(out.Taxon.ScientificName);
            }
        });


    }

    function updateFromText() {
        var val = org.val();
        tax.eSpell(val, function (err, res) {
            if (res) {
                tax.eSearch(res, function (err, out) {
                    if (out.length > 0) {

                        ul.empty();
                        var li = $('<li></li>');
                        var a = $('<a href="#ncbi">' + res + '</a>');
                        li.append(a);
                        a.on('click', function () {
                            ncbi.val(out[0]);
                            ul.empty();
                            updateFromNumber();
                        });
                        ul.append(a)

                    }
                });
            }
        });
    }

    ncbi.on('input', function () {
        var val = ncbi.val();
        if (!isNaN(val)) {
            updateFromNumber();
        }

    })

    org.on('input', function () {
        var val = org.val();


        if (isNaN(val)) {
            updateFromText();
        }


    });
</script>

<% include ../foot %>